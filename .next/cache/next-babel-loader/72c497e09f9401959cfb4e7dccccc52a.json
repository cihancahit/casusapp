{"ast":null,"code":"var __jsx = React.createElement;\nimport React, { useState, useEffect } from \"react\";\nimport { useRouter } from \"next/router\";\nimport socketIOClient from \"socket.io-client\";\nimport Swal from \"sweetalert2\";\nimport { parseCookies, setCookie } from \"nookies\";\nimport { withTranslation } from \"../utils/i18n\";\nimport NameEntry from \"../components/NameEntry\";\nimport Lobby from \"../components/Lobby\";\nimport InGame from \"../components/InGame\";\nimport Loading from \"../components/Loading\";\nimport { lockedMessage } from \"../utils/misc\";\nconst socket = socketIOClient();\n\nconst Game = ({\n  t,\n  loading\n}) => {\n  const router = useRouter();\n  const {\n    gameCode\n  } = router.query;\n  const {\n    0: gameState,\n    1: setGameState\n  } = useState({\n    status: \"loading\"\n  });\n  useEffect(() => {\n    const {\n      previousGameCode,\n      previousName\n    } = parseCookies();\n\n    if (previousGameCode === gameCode && previousName) {\n      socket.emit(\"joinGame\", {\n        gameCode,\n        previousName\n      });\n    } else {\n      socket.emit(\"joinGame\", {\n        gameCode\n      });\n    }\n\n    socket.on(\"gameChange\", newGameState => {\n      setGameState(newGameState); // setting disconnect handler after game has been joined,\n      // or else it will cause an infinite loop with the invalid handler\n\n      if (gameCode !== \"ffff\") {\n        socket.on(\"disconnect\", () => router.push(\"/\" + gameCode));\n      }\n    });\n    socket.on(\"invalid\", () => router.push(\"/join?invalid=\" + gameCode));\n    socket.on(\"badName\", () => Swal.fire(\"Name already in use\"));\n    socket.on(\"lockedWarning\", minutes => Swal.fire(lockedMessage(minutes)).then(() => router.push(\"/\")));\n    return function cleanup() {\n      socket.close();\n      setGameState({\n        status: \"loading\"\n      });\n    };\n  }, []);\n\n  const onNameEntry = name => {\n    socket.emit(\"name\", name);\n    setCookie(null, \"previousGameCode\", gameCode);\n    setCookie(null, \"previousName\", name);\n  };\n\n  const {\n    status,\n    me\n  } = gameState;\n  const showLoading = status === \"loading\" || loading;\n  const showNameEntry = !showLoading && !me.name;\n  const showLobby = !showNameEntry && status.startsWith(\"lobby\");\n  const showGame = !showNameEntry && status === \"ingame\";\n  return __jsx(React.Fragment, null, showLoading && __jsx(React.Fragment, null, __jsx(\"h3\", null, t(\"ui.waiting for players\")), __jsx(Loading, null)), !showLoading && __jsx(React.Fragment, null, showNameEntry && __jsx(NameEntry, {\n    onNameEntry: onNameEntry,\n    gameCode: gameState.code,\n    socket: socket\n  }), showLobby && __jsx(Lobby, {\n    gameState: gameState,\n    socket: socket\n  }), showGame && __jsx(InGame, {\n    gameState: gameState,\n    socket: socket\n  })));\n};\n\nexport default withTranslation(\"common\")(Game);","map":null,"metadata":{},"sourceType":"module"}